# ユーザーガイド

## 目次

1. [はじめに](#はじめに)
2. [セットアップ](#セットアップ)
3. [基本的な使い方](#基本的な使い方)
4. [各機能の詳細](#各機能の詳細)
5. [データの解釈](#データの解釈)
6. [トラブルシューティング](#トラブルシューティング)

## はじめに

電車遅延×天気データ相関分析システムは、天候が電車の遅延にどのような影響を与えるかを視覚的に分析できるツールです。

### 主な機能

- 🚊 路線別の遅延傾向分析
- 🌤️ 天候別の遅延パターン把握
- 📊 時系列での遅延推移確認
- 🗺️ 路線×天候のヒートマップ表示
- 📥 分析データのCSVエクスポート

## セットアップ

### 1. 必要な環境

- Python 3.8以上
- pip（Pythonパッケージマネージャー）

### 2. インストール手順

```bash
# リポジトリのクローン
git clone <repository-url>
cd data-visualization

# 仮想環境の作成（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係のインストール
pip install -r requirements.txt
```

### 3. 環境設定

```bash
# 環境変数ファイルの作成
cp .env.example .env
```

`.env`ファイルを編集し、必要なAPIキーを設定：

```
WEATHER_API_KEY=your_openweathermap_api_key_here
```

### 4. アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザが自動的に開き、`http://localhost:8501`でアプリケーションにアクセスできます。

## 基本的な使い方

### 画面構成

アプリケーションは以下の要素で構成されています：

1. **メインエリア**: グラフや分析結果の表示
2. **サイドバー**: フィルター設定
3. **タブ**: 異なる分析ビューの切り替え

### 基本操作フロー

1. **データの読み込み**
   - アプリ起動時に自動的にデータが読み込まれます
   - 初回起動時はサンプルデータが生成されます

2. **フィルター設定**
   - サイドバーで分析対象を絞り込み
   - 路線、天候、期間を選択

3. **分析結果の確認**
   - 各タブで異なる視点から分析結果を確認
   - インタラクティブなグラフで詳細を探索

4. **データのエクスポート**
   - 必要に応じて分析データをCSV形式でダウンロード

## 各機能の詳細

### 📊 概要タブ

主要な統計情報とサマリーグラフを表示します。

**表示内容:**
- 平均遅延時間
- 遅延発生率
- 降雨時の遅延増加率
- 降雨量との相関係数
- 天候別・路線別の平均遅延時間グラフ

**使い方:**
1. 全体的な傾向を把握
2. 特に影響の大きい要因を特定
3. 詳細分析が必要な箇所を見つける

### 🗺️ ヒートマップタブ

路線と天候の組み合わせによる遅延パターンを視覚化します。

**表示内容:**
- 路線×天候の遅延時間マトリックス
- 色の濃さで遅延の程度を表現
- 遅延が多い組み合わせTOP5

**使い方:**
1. 色の濃い部分（赤色）に注目
2. 特定の路線の天候耐性を確認
3. 最も影響を受けやすい組み合わせを特定

### 📈 時系列分析タブ

時間による遅延パターンの変化を分析します。

**表示内容:**
- 日別の遅延推移（7日移動平均付き）
- 時間帯別の遅延パターン
- 曜日別の遅延傾向

**使い方:**
1. 長期的なトレンドを確認
2. ラッシュアワーの影響を把握
3. 曜日による違いを理解

### 🔍 詳細データタブ

生データと詳細な統計情報を提供します。

**表示内容:**
- 天候要因との相関散布図
- フィルタリング可能なデータテーブル
- 統計サマリー
- CSVダウンロード機能

**使い方:**
1. 特定のデータポイントを詳しく調査
2. 相関関係を視覚的に確認
3. 分析用にデータをエクスポート

### 💡 インサイトタブ

分析結果のまとめと推奨事項を表示します。

**表示内容:**
- データ概要（期間、レコード数等）
- 主要な発見事項
- 実用的な推奨事項
- さらなる分析の提案

**使い方:**
1. 分析結果の要約を確認
2. 実践的なアクションを検討
3. 次の分析ステップを計画

## データの解釈

### 遅延時間の目安

- **0-5分**: 正常範囲内
- **5-15分**: 軽微な遅延
- **15-30分**: 中程度の遅延
- **30分以上**: 重大な遅延

### 相関係数の解釈

- **0.7以上**: 強い正の相関
- **0.3-0.7**: 中程度の正の相関
- **-0.3-0.3**: 弱い相関
- **-0.7--0.3**: 中程度の負の相関
- **-0.7以下**: 強い負の相関

### 天候の影響

- **雨天時**: 通常、遅延が増加
- **晴天時**: 最も遅延が少ない
- **曇天時**: 晴天に近い傾向

## トラブルシューティング

### よくある問題と解決方法

#### 1. アプリケーションが起動しない

**原因**: 依存関係が正しくインストールされていない
**解決方法**:
```bash
pip install -r requirements.txt --force-reinstall
```

#### 2. データが表示されない

**原因**: データファイルが存在しないか破損している
**解決方法**:
```bash
# サンプルデータを再生成
python src/data_analyzer.py
```

#### 3. グラフが正しく表示されない

**原因**: ブラウザの互換性問題
**解決方法**:
- Chrome、Firefox、Edgeなどの最新ブラウザを使用
- ブラウザのキャッシュをクリア

#### 4. APIエラーが発生する

**原因**: APIキーが設定されていないか無効
**解決方法**:
1. `.env`ファイルを確認
2. APIキーが正しく設定されているか確認
3. APIの利用制限を確認

### ログの確認

問題が解決しない場合は、ログを確認してください：

```bash
# ログディレクトリの確認
ls logs/

# 最新のログを表示
tail -f logs/app.log
```

## ベストプラクティス

### 1. データの定期更新

- 最新の分析結果を得るため、定期的にデータを更新
- cronジョブやタスクスケジューラーの活用を検討

### 2. フィルターの活用

- 特定の条件に絞って詳細な分析を実施
- 比較分析のため、複数の条件で結果を確認

### 3. エクスポート機能の活用

- 重要な分析結果はCSVでバックアップ
- Excelなど他のツールでの追加分析に活用

### 4. パフォーマンスの最適化

- 大量のデータを扱う場合は期間を限定
- 不要なタブは閉じてリソースを節約

## さらなる活用方法

### カスタマイズ

設定ファイル（`src/config.py`）を編集して：
- 分析対象の路線を追加
- 色スキームの変更
- ラッシュアワーの時間帯調整

### 自動化

- データ収集の自動化スクリプト作成
- 定期レポートの生成
- アラート機能の実装

### 統合

- 他のシステムとのAPI連携
- ダッシュボードの埋め込み
- データベースとの接続

## サポート

問題が発生した場合や機能リクエストがある場合は、GitHubのIssueページでお知らせください。